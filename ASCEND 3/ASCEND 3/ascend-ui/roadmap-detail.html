<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Roadmap Detail - ASCEND</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/variables.css">
    <link rel="stylesheet" href="css/reset.css">
    <link rel="stylesheet" href="css/global.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/pages.css">
    <script src="https://unpkg.com/lucide@latest"></script>
</head>

<body>
    <aside class="sidebar">
        <div class="sidebar-logo">
            <div class="sidebar-logo-icon">âš¡</div>
            <div class="sidebar-logo-text">ASCEND</div>
        </div>
        <nav class="sidebar-nav">
            <a href="dashboard.html" class="sidebar-nav-item">
                <i data-lucide="layout-dashboard" style="width: 20px; height: 20px;"></i>
                <span>Dashboard</span>
            </a>
            <a href="career-exploration.html?tab=roadmaps" class="sidebar-nav-item active">
                <i data-lucide="map" style="width: 20px; height: 20px;"></i>
                <span>Roadmaps</span>
            </a>
        </nav>
        <div class="sidebar-footer">
            <div class="sidebar-nav-item" id="collapseBtn">
                <i data-lucide="chevron-left" style="width: 20px; height: 20px; stroke-width: 1.5;"></i>
                <span>Collapse</span>
            </div>

            <a href="login.html" class="sidebar-nav-item" id="logoutBtn">
                <i data-lucide="log-out" style="width: 20px; height: 20px;"></i>
                <span>Sign Out</span>
            </a>
        </div>
    </aside>

    <!-- Header -->
    <header class="header">
        <!-- ... Header content ... -->
        <div class="header-search">
            <div class="input-icon">
                <span data-lucide="search" style="width: 18px; height: 18px; stroke-width: 1.5;"></span>
                <input type="text" class="input" placeholder="Search...">
            </div>
        </div>

        <div class="header-actions">
            <button class="btn btn-secondary btn-sm">
                <i data-lucide="bell" style="width: 18px; height: 18px; stroke-width: 1.5;"></i>
            </button>
            <div class="header-user">
                <div class="header-user-info">
                    <div class="header-user-name" id="userNameDisplay">Mentor</div>
                    <div class="header-user-role">Mentor</div>
                </div>
                <div class="avatar avatar-md" id="userAvatar">ME</div>
            </div>
        </div>
    </header>

    <main class="main-layout">
        <div class="page-container">
            <div class="main-content">
                <div class="page-header">
                    <a href="career-exploration.html?tab=roadmaps"
                        style="color: var(--text-secondary); display: flex; align-items: center; margin-bottom: 1rem;">
                        <i data-lucide="arrow-left" style="width: 16px; height: 16px; margin-right: 0.5rem;"></i> Back
                        to Roadmaps
                    </a>
                    <h1 class="page-title" id="roadmapTitle">Loading...</h1>
                    <p class="text-secondary" id="roadmapDesc">...</p>
                </div>

                <div class="card">
                    <div class="card-body">
                        <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 2rem;">
                            <div class="avatar avatar-md" id="creatorAvatar">?</div>
                            <div>
                                <div style="font-weight: 600;" id="creatorName">Unknown</div>
                                <div style="color: var(--text-secondary); font-size: 0.9rem;" id="creatorRole">Mentor
                                </div>
                            </div>
                        </div>

                        <h3 style="margin-bottom: 1rem;">Roadmap Steps</h3>
                        <div id="stepsContainer">
                            <!-- Steps loaded here -->
                        </div>
                    </div>
                </div>
            </div>
            <!-- Footer -->
            <div id="footer-placeholder" data-src="dashboard-footer.html"></div>
        </div>
        </div>
    </main>

    <script src="js/navigation.js"></script>
    <script src="js/auth-guard.js"></script>
    <script>
        lucide.createIcons();

        document.addEventListener('DOMContentLoaded', async () => {
            const token = localStorage.getItem('auth_token');
            const urlParams = new URLSearchParams(window.location.search);
            const roadmapId = urlParams.get('id');

            if (!roadmapId) {
                alert('No roadmap specified');
                window.location.href = 'career-exploration.html?tab=roadmaps';
                return;
            }

            try {
                // Fetch specific roadmap detail
                const response = await fetch(`http://127.0.0.1:5000/api/career/roadmaps/${roadmapId}`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                if (response.ok) {
                    const r = await response.json();
                    document.getElementById('roadmapTitle').textContent = r.title;
                    document.getElementById('roadmapDesc').textContent = r.description;
                    document.getElementById('creatorName').textContent = r.creator;
                    document.getElementById('creatorRole').textContent = r.creator_role || 'Mentor';
                    document.getElementById('creatorAvatar').textContent = r.creator.substring(0, 2).toUpperCase();

                    const container = document.getElementById('stepsContainer');
                    if (r.steps) {
                        // Steps might be JSON or text. Let's try to parse if JSON, else split by newlines
                        let steps = [];
                        try {
                            steps = JSON.parse(r.steps);
                        } catch (e) {
                            // Treat as newline separated text
                            if (typeof r.steps === 'string') {
                                steps = r.steps.split('\n').filter(s => s.trim() !== '').map(s => ({ title: s }));
                            }
                        }

                        if (Array.isArray(steps)) {
                            steps.forEach((step, index) => {
                                // If step is object with title/desc, use that. Else just string.
                                const title = step.title || step;
                                const desc = step.description || '';

                                const html = `
                                    <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem;">
                                        <div style="width: 32px; height: 32px; background: var(--primary); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 600; flex-shrink: 0;">${index + 1}</div>
                                        <div>
                                            <h4 style="font-weight: 600; margin-bottom: 0.25rem;">${title}</h4>
                                            <p style="color: var(--text-secondary); line-height: 1.5;">${desc}</p>
                                        </div>
                                    </div>
                                `;
                                container.insertAdjacentHTML('beforeend', html);
                            });
                        } else {
                            container.innerHTML = '<p>' + r.steps + '</p>';
                        }
                    } else {
                        container.innerHTML = '<p style="color: var(--text-secondary);">No steps defined for this roadmap.</p>';
                    }
                } else {
                    alert('Roadmap not found');
                }
            } catch (error) {
                console.error('Error:', error);
            }
        });
    </script>
</body>

</html>