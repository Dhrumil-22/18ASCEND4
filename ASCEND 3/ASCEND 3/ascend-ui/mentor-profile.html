<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mentor Profile - ASCEND</title>
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- CSS -->
    <!-- CSS -->
    <link rel="stylesheet" href="css/variables.css">
    <link rel="stylesheet" href="css/reset.css">
    <link rel="stylesheet" href="css/global.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/pages.css">
    <link rel="stylesheet" href="css/header-style.css">
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="js/include-components.js"></script>
</head>

<body>
    <!-- Sidebar -->
    <div id="sidebar-placeholder" data-src="mentor-sidebar.html"></div>

    <!-- Header -->
    <header class="header">
        <div class="dashboard-nav-group">
            <!-- Nav links removed as per request -->
        </div>

        <div style="display: flex; align-items: center; gap: 1.5rem;">
            <button onclick="window.location.href='mentor-messages.html'"
                style="background: none; border: none; color: var(--text-secondary); cursor: pointer; padding: 0.5rem; display: flex; align-items: center; transition: color 0.2s;">
                <i data-lucide="message-square" style="width: 20px; height: 20px;"></i>
            </button>
            <div class="header-user" onclick="window.location.href='mentor-profile.html'" style="cursor: pointer;">
                <div class="header-user-info">
                    <div class="header-user-name">Mentor Name</div>
                    <div class="header-user-role">Mentor</div>
                </div>
                <div class="avatar avatar-md">ME</div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-layout">
        <div class="page-container">
            <div class="main-content">
                <div class="page-header">
                    <h1 class="page-title">Mentor Profile</h1>
                    <p class="text-secondary">Manage your public mentor profile.</p>
                </div>

                <!-- Reusing the Profile Form Structure, slightly adapted for Mentors -->
                <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 24px;">
                    <!-- Edit Form -->
                    <div class="card">
                        <div class="card-body">
                            <form id="profileForm">
                                <h3 style="margin-bottom: 20px; font-size: 18px; font-weight: 600;">Expertise & Bio</h3>

                                <div class="input-group">
                                    <label class="input-label">Full Name</label>
                                    <input type="text" class="input" id="fullName" placeholder="Your Name">
                                </div>

                                <div class="input-group">
                                    <label class="input-label">Current Role</label>
                                    <input type="text" class="input" id="currentGoalInput"
                                        placeholder="e.g. Senior Software Engineer at Google">
                                    <p style="font-size: 12px; color: var(--text-secondary); margin-top: 6px;">This is
                                        your headline.</p>
                                </div>

                                <div class="input-group">
                                    <label class="input-label">Bio</label>
                                    <textarea class="input" id="bio" rows="4"
                                        placeholder="Share your experience and mentorship style..."></textarea>
                                </div>

                                <div class="input-group">
                                    <label class="input-label">Skills / Expertise (Comma separated)</label>
                                    <input type="text" class="input" id="skillsInput"
                                        placeholder="System Design, Leadership, Python, Career Growth">
                                </div>

                                <div style="margin-top: 32px; display: flex; justify-content: flex-end;">
                                    <button type="submit" class="btn btn-primary">Save Profile</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

            </div>
            <!-- Footer -->
            <div id="footer-placeholder" data-src="dashboard-footer.html"></div>
        </div>
        </div>
    </main>

    <script src="js/navigation.js"></script>
    <script src="js/auth-guard.js"></script>
    <script>
        lucide.createIcons();



        document.addEventListener('DOMContentLoaded', async () => {
            const token = localStorage.getItem('auth_token');
            if (!token) window.location.href = 'login.html';

            try {
                const response = await fetch('http://127.0.0.1:5000/api/user/profile', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                if (response.ok) {
                    const data = await response.json();

                    // Update header
                    if (data.username || (data.profile && data.profile.full_name)) {
                        const nameToDisplay = (data.profile && data.profile.full_name) || data.username;
                        const headerName = document.querySelector('.header-user-name');
                        if (headerName) headerName.textContent = nameToDisplay;

                        const headerAvatar = document.querySelector('.header-user .avatar');
                        if (headerAvatar) {
                            headerAvatar.textContent = nameToDisplay.substring(0, 2).toUpperCase();
                        }
                    }

                    if (data.profile) {
                        if (document.getElementById('fullName')) document.getElementById('fullName').value = data.profile.full_name || '';
                        if (document.getElementById('currentGoalInput')) document.getElementById('currentGoalInput').value = data.profile.current_goal || '';
                        if (document.getElementById('bio')) document.getElementById('bio').value = data.profile.bio || '';
                    }
                    if (data.skills) {
                        if (document.getElementById('skillsInput')) document.getElementById('skillsInput').value = data.skills.join(', ');
                    }
                }
            } catch (error) {
                console.error('Error loading profile', error);
            }
        });

        document.getElementById('profileForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const token = localStorage.getItem('auth_token');

            const fullName = document.getElementById('fullName').value;
            const currentGoal = document.getElementById('currentGoalInput').value;
            const bio = document.getElementById('bio').value;
            const skills = document.getElementById('skillsInput').value;

            try {
                const response = await fetch('http://127.0.0.1:5000/api/user/profile', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        full_name: fullName,
                        current_goal: currentGoal,
                        bio: bio,
                        skills: skills
                    })
                });

                if (response.ok) {
                    alert('Profile updated!');
                } else {
                    alert('Failed to update.');
                }
            } catch (error) {
                console.error('Error saving:', error);
            }
        });
    </script>
</body>

</html>